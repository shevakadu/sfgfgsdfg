// JavaScript Document

// Table of contents:
// * Mapping of the main UI parts
// * Animating
// * MOTDs
// * Function:Add post to feed
// * Function:Check if logged in
// * Function:Show an error/info
// * Animate filter options
// * Animate the searchbar
// * Add localization

// * Function:Activate an account
// * Function:Log into an account
// * Function:Get account data
// * Function:Refresh own account
// * Function:Log out of account
// * Function:Change passive account data
// * Function:Change status
// * Function:Create a post
// * Function:Get posts

// * Check if logged in

console.log("sus")

window.onload = function() {
	// Mapping of the elements of the main page
	const elements = {
		mapping: {
			"editbar-header": "editbar",
			"authbar-header": "authbar",
			"filterbar-filterbutton": "searchbar"
		},
		"userbar": {
			header: null,
			contents: {
				userbg: document.getElementById("userbar-background-image"),
				useravatar: document.getElementById("userbar-profile-image"),
				username: document.getElementById("userbar-profile-username"),
				userstatus: document.getElementById("userbar-profile-status"),
				
				submitbutton: document.getElementById("userbar-profile-updatestatus"),
				profile: document.getElementById("userbar-profile"),
				welcome: document.getElementById("userbar-welcome")
			},
			open: true,
			initial_height: document.getElementById("authbar-contents").style.height,
			bartype: "non-folding"
		},
		"editbar": {
			header: document.getElementById("editbar-header"),
			contents: {
				content_source: document.getElementById("editbar-contents"),
				contents: {
					usernamefield: document.getElementById("editbar-contents-username"),
					passwordfield: document.getElementById("editbar-contents-password"),
					profileiconurlfield: document.getElementById("editbar-contents-profileiconurl"),
					submitbuttton: document.getElementById("editbar-contents-submitchanges")
				}
			},
			open: false,
			initial_height: document.getElementById("editbar-contents").style.height,
			bartype: "folding"
		},
		"authbar": {
			header: document.getElementById("authbar-header"),
			contents: {
				content_source: document.getElementById("authbar-contents"),
				contents: {
					usernamefield: document.getElementById("authbar-contents-username"),
					passwordfield: document.getElementById("authbar-contents-password"),
					loginbutton: document.getElementById("authbar-contents-useaccount"),
					
					invitecodefield: document.getElementById("authbar-contents-invitecode"),
					useinvitecodebutton: document.getElementById("authbar-contents-useinvitecode"),
					
					authinfo: document.getElementById("authbar-contents-info"),
					welcome: document.getElementById("authbar-welcome")
				}
			},
			open: true,
			initial_height: document.getElementById("authbar-contents").style.height,
			bartype: "folding"
		},
		"postbar": {
			header: null,
			contents: {
				postinput: document.getElementById("postbar-postinput"),
				taginput: document.getElementById("postbar-taginput"),
				mentioninput: document.getElementById("postbar-mentioninput"),
				
				info: document.getElementById("postbar-submiterror"),
				postbutton: document.getElementById("postbar-submitbutton"),
				
				itself: document.getElementById("postbar")
			},
			open: true,
			initial_height: document.getElementById("authbar-contents").style.height,
			bartype: "non-folding"
		},
		"filterbar": {
			header: null,
			contents: {
				// not yet
			},
			open: true,
			initial_height: document.getElementById("authbar-contents").style.height,
			bartype: "non-folding"
		},
		"searchbar": {
			header: document.getElementById("filterbar-filterbutton"),
			contents: {
				content_source: document.getElementById("filterbar-contents"),
				contents: {
					usersearchinput: document.getElementById("searchbar-usersearchinput"),
					tagsearchinput: document.getElementById("searchbar-tagsearchinput"),
					
					filterbutton: document.getElementById("searchbar-submitbutton")
				}
			},
			open: false,
			initial_height: document.getElementById("filterbar-contents").style.height,
			bartype: "non-folding"
		}
	}
	
	// Animating the elements
	
	for (var name in elements) {
		console.log(name)
		bar = elements[name]
		console.log(bar)
		if (bar.bartype == "folding") {
//			if (bar.open == false) {
//				bar.contents.content_source.style.height = "0px"
//				bar.contents.content_source.style.padding = "0px"		
//			}
			
			console.log(bar.header)
			
//			bar.header.addEventListener("click", function() {
//				console.log(this)
//				if (bar.open == false) {
//					bar.open = true
//					bar.contents.content_source.style.height = bar.initial_height
//					bar.contents.content_source.style.padding = "20px"
//				} else {
//					bar.open = false
//					bar.contents.content_source.style.height = "0px"
//					bar.contents.content_source.style.padding = "0px"
//				}
//			})
			
			bar.header.onclick = function() {
				var clickedon = elements[elements.mapping[this.id]]
				console.log(bar)
				if (clickedon.open == false) {
					clickedon.open = true
					clickedon.contents.content_source.style.maxHeight = "1000px" //clickedon.initial_height
					clickedon.contents.content_source.style.padding = "20px"
				} else {
					clickedon.open = false
					clickedon.contents.content_source.style.padding = "0 20px 0 20px"
					clickedon.contents.content_source.style.maxHeight = "0px"
				}
			}
		}
	}
	
	// Here should be the controller for the MOTDs...
//	const motds = []
	
	// Function to create a post on the feed
	// Example:
//        <div class="post">                                                                                    V
//            <div class="post-top-bar">                                                                        V
//                <div class="post-author-avatar-container">                                                    V
//                    <img src="stock image yay.jpg" alt="sdfdsfsdfdsfafasf" class="post-author-avatar">        V
//                </div>                                                                                        V
//                <div class="post-author-name">*-*-&lt;3_MashUnyA_∆ê&gt;-*-*</div>                              V
//                <div class="post-author-info">said at 20:00 10/03/2023</div>
//            </div>
//            <div class="post-contents">omg guys!!111! this is so awesome cool and amazing! who wants to go out with me?????
//            </div>
//        </div>
	
	function add_post_to_feed(author, pfp, hour, minute, day, month, year, contents, tag, mention, type) {
		// Types:
		// textpost (v)
		// mention (v)
		// status
		// news (v)
		// help
//		if (type == null || type == undefined || type == "textpost" || type == "news") {
        var post_shell = document.createElement('div')
        if (mention != localStorage.networking_credentialUsername) {
            post_shell.setAttribute('class', 'post')
        } else {
            if (localStorage.networking_allowStandbyAuth == "true") {
                post_shell.setAttribute('class', 'post post-type-mention')
            } else {
                post_shell.setAttribute('class', 'post')
            }
        }

        if (type == "news") {
            post_shell.setAttribute('class', 'post post-type-news')
        }

        var post_top_bar = document.createElement('div')
        post_top_bar.setAttribute('class', 'post-top-bar')

        var post_author_avatar_container = document.createElement('div')
        post_author_avatar_container.setAttribute('class', 'post-author-avatar-container')

        var post_author_avatar = document.createElement('img')
        post_author_avatar.setAttribute('class', 'post-author-avatar')

        post_author_avatar.setAttribute('src', pfp)
		if (type == "activation") {
			post_author_avatar.setAttribute('src', "index_stuff/eggy")
		}
        post_author_avatar.setAttribute('alt', 'epic epic epic epic epic epicepic epicepicepicepic epicepicepicepic')
//		post_author_avatar.setAttribute('onerror', "this.onerror=null;this.src='https://placehold.co/80/png?text=profile%0Apicture%0Anot%0Afound';")
        post_author_avatar.setAttribute('onerror', "this.onerror=null;this.src='https://loremflickr.com/320/320';")
        // document.getElementById("userbar-profile-image").setAttribute('onerror', "this.onerror=null;this.src='https://loremflickr.com/320/320';")
        // https://loremflickr.com/320/320 - photos
        // https://placehold.co/80/png?text=%20 - a question mark
        // https://placekitten.com/300/300 - kitten images
        // https://picsum.photos/ - photos
        // https://fakeimg.pl/ - placeholders
        // https://placebear.com/ - bear images
        // http://dummy-image-generator.com/ - photos
        // gotta choose i guess

        var post_author_name = document.createElement('div')
        post_author_name.setAttribute('class', 'post-author-name')
		if (type != "status"  && type != "activation") {
        	post_author_name.innerHTML = author
		} else if (type == "activation") {
			post_author_name.innerHTML = "someone just joined!"
		} else if (type == "status") {
			post_author_name.innerHTML = `${author} changed their status to ${contents}`
		}

        var post_author_info = document.createElement('div')
        post_author_info.setAttribute('class', 'post-author-info')
		if (type != "status" && type != "activation") {
            if (minute.length == 2) {
                post_author_info.innerHTML = `said at ${hour}:${minute} ${day}/${month}/${year}`
            } else {
                post_author_info.innerHTML = `said at ${hour}:0${minute} ${day}/${month}/${year}`
            }
		} else {
			if (minute.length == 2) {
                post_author_info.innerHTML = `on ${hour}:${minute} ${day}/${month}/${year}`
            } else {
                post_author_info.innerHTML = `on ${hour}:0${minute} ${day}/${month}/${year}`
            }
		}

        var post_contents = document.createElement('div')
        post_contents.setAttribute('class', 'post-contents')
		if (type != "activation" && type != "status") {
        	post_contents.innerHTML = contents
		} else {
			post_contents.innerHTML = ""
		}
		
		if (type != "activation" && type != "status") {
            console.log(tag, mention)
            var post_info = document.createElement('div')
            post_info.setAttribute('class', 'post-info')
            if (tag != null && tag != undefined && tag.length > 0) {
                post_info.innerHTML = `Tagged with ${tag}, `
            } else {
                post_info.innerHTML = "Not tagged, "
            }
            if (mention != null && mention != undefined && mention.length > 0) {
                post_info.innerHTML += `mentions: ${mention}.`
            } else {
                post_info.innerHTML += "no mentions."
            }
		}

//		console.log("hello!!111!1!!!1")
//		console.log(document.getElementById("postfeedcontents").firstChild)
//		console.log("bye:(!!111!1!!!1")
        document.getElementById("postfeedcontents").appendChild(post_shell, document.getElementById("postfeedcontents").firstChild)
        post_shell.appendChild(post_top_bar)
        post_top_bar.appendChild(post_author_avatar_container)
        post_author_avatar_container.appendChild(post_author_avatar)
        post_top_bar.appendChild(post_author_name)
        post_top_bar.appendChild(post_author_info)
        post_shell.appendChild(post_contents)
        if (type != "news" && type != "status" && type != "activation") { post_contents.appendChild(post_info) }
		// }
	}
	
	function clear_feed() {
		document.getElementById("postfeedcontents").replaceChildren()
	}
	
	// ok so:
	// first, the code needs to check if the user is logged in
	// if the user isn't, show the auth bar and hide the others (also show userbar-welcome)
	// otherwise, hide the auth bar.
	
	// variables for preserving the credentials:
	// networking_allowStandbyAuth      - determines if user is logged in
	// networking_credentialUsername    - the username used for authentification
	// networking_credentialPassword    - the password used for authentification
	// networking_credentialInviteCode  - the last invite code used on the system
	// decoration_backgroundImageURL    - locally stored url for the background image
	
	function check_if_logged_in() {
		console.log(localStorage.networking_allowStandbyAuth)
        if (localStorage.networking_allowStandbyAuth != "true") {
            console.log("User is not logged in according to local storage.")
            elements.userbar.contents.profile.style.display = "none"
            elements.userbar.contents.welcome.style.display = "block"

            elements.editbar.header.style.display = "none"
            elements.editbar.contents.content_source.style.display = "none"

            elements.authbar.header.style.display = "block"
            elements.authbar.contents.content_source.style.display = "block"
			elements.authbar.contents.contents.welcome.style.display = "none"

            elements.postbar.contents.itself.style.display = "none"
			
			document.getElementById("filterbar-filter-mentions").style.display = "none"
        } else {
            console.log("User is logged in according to local storage.")
            elements.userbar.contents.profile.style.display = "block"
            elements.userbar.contents.welcome.style.display = "none"

            elements.editbar.header.style.display = "block"	
            elements.editbar.contents.content_source.style.display = "block"
			if (localStorage.decoration_backgroundImageURL != undefined) {
				document.getElementById("editbar-contents-backgroundimageurl").value = localStorage.decoration_backgroundImageURL
			}

            elements.authbar.header.style.display = "none"
            elements.authbar.contents.content_source.style.display = "none"
			elements.authbar.contents.contents.welcome.style.display = "none"

            elements.postbar.contents.itself.style.display = "block"
			
			get_own_profile()
			document.getElementById("filterbar-filter-mentions").style.display = "inline"
        }
	}
	
	function show_info(where, info) {
		where.innerHTML = info
		where.style.opacity = "1"
		setTimeout(function() {
			where.style.transition = "opacity 1s linear"
			setTimeout(function() {
				where.style.opacity = "0"
			}, 100)
			setTimeout(function() {
				where.style.transition = "none"
			}, 1200)
		}, 1000)
	}
	
	var filteroptionelements = []
	for (var filteroption of document.getElementsByClassName("filterbar-filteroption")) {
		filteroptionelements[filteroption.innerHTML.toLowerCase()] = filteroption
		filteroption.addEventListener("click", function() {
			highlight_filter_option(this.innerHTML.toLowerCase())
		})
	}
	
	var highlitedfilteroption = "all"
	function highlight_filter_option(option) {
		for (var [key, value] of Object.entries(filteroptionelements)) {
			value.setAttribute("class", "filterbar-filteroption")
		}
		if (translated) {
			filteroptionelements[translation.translation_filters[option]].setAttribute("class", "filterbar-filteroption feed-selected")
			highlitedfilteroption = translation.translation_filters[option]
		} else {
			filteroptionelements[option].setAttribute("class", "filterbar-filteroption feed-selected")
			highlitedfilteroption = option
		}
		
		if (highlitedfilteroption == "search") {
			document.getElementById("filterbar-contents").style.display = "block"
		} else {
			document.getElementById("filterbar-contents").style.display = "none"
		}
	}
	highlight_filter_option("all")
	console.log(filteroptionelements)
	
	var searchoptions = []
	for (var searchoption of document.getElementsByClassName("searchbar-option")) {
//		searchoptions[searchoption.innerHTML.replace(/\s+/g, '-').toLowerCase()] = searchoption
//		searchoption.addEventListener("click", function() {
//			highlight_search_option(this.innerHTML.replace(/\s+/g, '-').toLowerCase())
//		})
		searchoptions[searchoption.getAttribute("id")] = searchoption
		searchoption.addEventListener("click", function() {
			highlight_search_option(this.getAttribute("id"))
		})
	}
	
	var highlitedsearchoption = "all"
	function highlight_search_option(option) {
		for (var [key, value] of Object.entries(searchoptions)) {
			value.setAttribute("class", "searchbar-option")
		}
		searchoptions[option].setAttribute("class", "searchbar-option searchbar-option-selected")
		highlitedsearchoption = option
		
		if (translated) {
			document.getElementById("searchbar-input").setAttribute("placeholder", {"searchbar-option-user": "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å.", "searchbar-option-tag": "–í–≤–µ–¥–∏—Ç–µ –º–µ—Ç–∫—É, –æ—Ç–º–µ—á–µ–Ω—ã –∫–æ—Ç–æ—Ä–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å.", "searchbar-option-mention": "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É–ø–æ–º–∏–Ω–∞—é—â–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å."}[highlitedsearchoption])			
		} else {
			document.getElementById("searchbar-input").setAttribute("placeholder", {"searchbar-option-user": "Enter a username to see their posts and info.", "searchbar-option-tag": "Type in a tag to find posts with that tag.", "searchbar-option-mention": "See posts which mention someone."}[highlitedsearchoption])
		}
	}
	console.log("search options everybody")
	console.log(searchoptions)
	
	const translation = {
		translation_text: {
			"errorbar": "–û –Ω–µ—Ç! –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Ç–µ—Ä—è–Ω–æ :–û",
 			"headerbar-text": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å",
 			"userbar-profile-welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å",
 			"userbar-profile-username": "–ó–∞–≥—Ä—É–∑–∫–∞...",
 			"userbar-profile-status": "",
 			"userbar-profile-updatestatus": "–û–ë–ù–û–í–ò–¢–¨<br>–°–¢–ê–¢–£–°",
 			"userbar-profile-statusupdateinfo": "–ü–†–ï–í–´–®–ï–ù–û –ö–û–õ–ò–ß–ï–°–¢–í–û –°–ò–ú–í–û–õ–û–í",
 			"userbar-welcome": `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–Ω—É—é —Å–æ—Ü–∏–∞–ª—å–Ω—É—é —Å–µ—Ç—å –≤ —Å–µ—Ç–∏ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç!<br>
					–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É.<br>
					–ó–Ω–∞–∫–æ–º—å—Ç–µ—Å—å –∏ –æ–±—â–∞–π—Ç–µ—Å—å —Å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏.<br><break></break>
					–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –µ—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –∑–Ω–∞—á–∏—Ç –≤–∞—Å –Ω–µ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏.`,
 			"editbar-header": "–† –ï –î –ê –ö –¢ –ò –† –û –í –ê –¢ –¨",
 			"editbar-contents-text-username": "–ò–ú–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø",
 			"editbar-contents-text-pfpurl": "–°–°–´–õ–ö–ê –ù–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï",
 			"editbar-contents-text-password": "–ü–ê–†–û–õ–¨",
 			"editbar-contents-text-bgurl": "–§–û–ù–û–í–û–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï",
 			"editbar-contents-text-options": "–û–ü–¶–ò–ò",
 			"editbar-contents-submitchanges": "–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø",
 			"editbar-contents-logout": "–í–´–ô–¢–ò",
 			"editbar-contents-info": "–û–î–ù–û –ò–ó –ü–û–õ–ï–ô –ü–£–°–¢–û.",
 			"notification": `–ü—Ä–∏–≤–µ—Ç!<br>
				–ö–æ–º–∞–Ω–¥–∞ Chirp –±–µ–∑—É–º–Ω–æ —Ä–∞–¥–∞ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å —Ç–µ–±—è –Ω–∞ —ç—Ç–æ–º —Å–∞–π—Ç–µ. To get started, please take a moment to set up your unique username and secure password, so you will be able to login later. Thanks for joining us, and we look forward to connecting with you!<br>
				<ul>
					<li>Set up your username and password in the Edit bar above.<br>
						Expand the Edit bar by clicking on it.</li><break></break>
					<li>Write a post using the Post form below -<br>
						you can give your post a tag to put it in a topic,<br>
						or mention someone and highlight your post for whomever you mention.</li><break></break>
					<li>See what others wrote in the Feed below.</li>
				</ul>
				<button id="notification-close">–ó–ê–ö–†–´–¢–¨</button>`,
			"authbar-header": "–ê –£ –¢ –ï –ù –¢ –ò –§ –ò –ö –ê –¶ –ò –Ø",
			"authbar-contents-text-username": "–ò–ú–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø",
			"authbar-contents-text-password": "–ü–ê–†–û–õ–¨",
			"authbar-contents-text-invitecode": "–ö–û–î –ü–†–ò–ì–õ–ê–®–ï–ù–ò–Ø",
			"authbar-contents-text-useinvitecode": "–ï–°–õ–ò –£ –í–ê–° –ö–û–î –ü–†–ò–ì–õ–ê–®–ï–ù–ò–Ø",
			"authbar-contents-useinvitecode": "–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢",
			"authbar-contents-text-useaccount": "–ï–°–õ–ò –£ –í–ê–° –£–ñ–ï –ï–°–¢–¨ –ê–ö–ö–ê–£–ù–¢",
			"authbar-contents-useaccount": "–í–û–ô–¢–ò –í –ê–ö–ö–ê–£–ù–¢",
			"authbar-welcome-contents-text": `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!<br>
				–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –≤ –Ω–∞—à–µ–π —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.<br>
				–ú—ã —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∞—Å –≤ –Ω–∞—à–µ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ –∏ –≥–æ—Ç–æ–≤—ã<br>–ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤–∞—Å —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –æ–±—ä—è—Ç–∏—è–º–∏.<br><break></break>
				–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã, –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞ –Ω–∏–∂–µ<br>–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–≤–æ–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.<br>
				–° —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å,<br>–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –¥—Ä—É–∑—å—è–º –∏ –Ω–∞—á–∞—Ç—å –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏ –∏ –∏–¥–µ—è–º–∏ —Å–æ –≤—Å–µ–º –º–∏—Ä–æ–º.<br><break></break>
				–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—à—É —Å–æ—Ü–∏–∞–ª—å–Ω—É—é —Å–µ—Ç—å, –∏ –º—ã –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∞–º–∏!`,
			"authbar-welcome-login": "–í–û–ô–¢–ò!",
			"postbar-header": "–ù –ê –ü –ò –° –ê –¢ –¨&emsp;–ü –û –° –¢",
			"postbar-submitbutton": "–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨",
			"filterbar-filter-all": "–í–°–Å",
			"filterbar-filter-mentions": "–£–ü–û–ú–ò–ù–ê–ù–ò–Ø",
			"filterbar-filter-updates": "–û–ë–ù–û–í–õ–ï–ù–ò–Ø",
			"filterbar-filter-news": "–ù–û–í–û–°–¢–ò",
			"filterbar-filterbutton": "–ü–û–ò–°–ö",
			"filterbar-filter-help": "–ü–û–ú–û–©–¨",
			"searchbar-option-user": "–ò–°–ö–ê–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø",
			"searchbar-option-tag": "–ò–°–ö–ê–¢–¨ –ú–ï–¢–ö–£",
			"searchbar-option-mention": "–ò–°–ö–ê–¢–¨ –£–ü–û–ú–ò–ù–ê–ù–ò–ï",
			"searchbar-submitbutton": "–û–¢–§–ò–õ–¨–¢–†–û–í–ê–¢–¨ –ü–£–ë–õ–ò–ö–ê–¶–ò–ò",
			"feed-header": "–ü –£ –ë –õ –ò –ö –ê –¶ –ò –ò",
			"feed-refresh": "–û–ë–ù–û–í–ò–¢–¨"
		},
		translation_placeholders: {
			"userbar-profile-status": "–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å —Ç—É—Ç.			–õ–∏–º–∏—Ç - 32 —Å–∏–º–≤–æ–ª–∞.",
			"editbar-contents-username": "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—é–¥–∞.",
			"editbar-contents-password": "–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —Å—é–¥–∞.",
			"editbar-contents-profileiconurl": "–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ URL-–∞–¥—Ä–µ—Å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è.",
			"editbar-contents-backgroundimageurl": "–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ URL-–∞–¥—Ä–µ—Å —Ñ–æ–Ω–æ–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏.",
			"authbar-contents-username": "–ï—Å–ª–∏ –∂–µ —É –≤–∞—Å –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.",
			"authbar-contents-invitecode": "–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ —Å—é–¥–∞.",
			"authbar-contents-password": "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–∞—Ä–æ–ª—å.",
			"postbar-postinput": `–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å —Å—é–¥–∞, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨ —á—Ç–æ–±—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å.
–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –Ω–∏—á–µ–≥–æ –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∏ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 128 —Å–∏–º–≤–æ–ª–æ–≤.`,
			"postbar-taginput": "–û—Ç–º–µ—Ç—å—Ç–µ –ø–æ—Å—Ç - –æ—Ç–Ω–µ—Å–∏—Ç–µ –µ–≥–æ –≤ —Ç—É –∏–ª–∏ –∏–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é.",
			"postbar-mentioninput": "–£–ø–æ–º—è–Ω–∏—Ç–µ –∫–æ–≥–æ-—Ç–æ - –≤–∞—à –ø–æ—Å—Ç –±—É–¥–µ—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω –¥–ª—è –Ω–∏—Ö!"
		},
		translation_filters: {
			"–≤—Å–µ": "all",
			"—É–ø–æ–º–∏–Ω–∞–Ω–∏—è": "mentions",
			"–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è": "updates",
			"–Ω–æ–≤–æ—Å—Ç–∏": "news",
			"–ø–æ–∏—Å–∫": "search",
			"–ø–æ–º–æ—â—å": "help"}
	}
	
	const initial_language = {translation_text: {}, translation_placeholders: {}}
	
	function translate(localize) {
		if (localize)  {
			for (var [key, value] of Object.entries(translation.translation_text)) {
				if (document.getElementById(key) != null) {
					initial_language.translation_text[key] = document.getElementById(key).innerHTML
					document.getElementById(key).innerHTML = value
				}
			}
			for (var [key, value] of Object.entries(translation.translation_placeholders)) {
				if (document.getElementById(key) != null) {
					initial_language.translation_placeholders[key] = document.getElementById(key).getAttribute("placeholder")
					document.getElementById(key).setAttribute("placeholder", value)
				}
			}
		} else {
			for (var [key, value] of Object.entries(initial_language.translation_text)) {
				if (document.getElementById(key) != null) {
					document.getElementById(key).innerHTML = value
				}
			}
			for (var [key, value] of Object.entries(initial_language.translation_placeholders)) {
				if (document.getElementById(key) != null) {
					document.getElementById(key).setAttribute("placeholder", value)
				}
			}	
		}
	}
	
	
	var request_gate = new XMLHttpRequest()
	var request_host = "http://localhost:3000/"
	var request_path = null
	var request_params = null
	var request_response = null
	
	function activate_account(invite_code) {
		request_path = "activate_account"
		request_params = {"request_type": "activate_account",
						  "invite_code": invite_code}
		request_gate.open("POST", request_host + request_path)
		request_gate.responseType = "json"
		request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
		request_gate.onreadystatechange = function() {
			if (request_gate.readyState == XMLHttpRequest.DONE) {
				console.log("Account activation: response received!")
				console.log(request_gate.response)
				var wonky_wtf = request_gate.response
				if (request_gate.response["general_type"] == "error") {
					if (request_gate.response["response_type"] == "action_cancelled") {
						if (request_gate.response["response_content"] == "invite_code_empty") {
							show_info(document.getElementById("authbar-contents-info"), "INVITE CODE FIELD IS EMPTY")
						} else if (request_gate.response["response_content"] == "invite_code_too_short") {
							show_info(document.getElementById("authbar-contents-info"), "INVITE CODE TOO SHORT")
						}
					} else if (request_gate.response["response_type"] == "internal_error") {
						show_info(document.getElementById("authbar-contents-info"), "OOPS! A SERVER ERROR!")
					} else if (request_gate.response["response_type"] == "action_failed") {
						if (request_gate.response["response_content"] == "no_such_account") {
							show_info(document.getElementById("authbar-contents-info"), "NO SUCH ACCOUNTS WERE FOUND.")
						} else if (request_gate.response["response_content"] == "multiple_accounts") {
							show_info(document.getElementById("authbar-contents-info"), "WOMP! MULTIPLE ACCOUNTS WERE FOUND!")
						} else if (request_gate.response["response_content"] == "unknown") {
							show_info(document.getElementById("authbar-contents-info"), "OOPS! AN UNKNOWN ERROR HAPPENED!")
						}
					}
				} else if (request_gate.response["general_type"] == "success") {
					if (request_gate.response["response_type"] == "account_activated") {
						elements.authbar.contents.content_source.style.display = "none"
						elements.authbar.contents.contents.welcome.style.display = "block"
						
						elements.authbar.contents.contents.invitecodefield.value = ""
						highlight_filter_option("all")
						get_posts("all", null)
						
						console.log("repsoufgdjhsfhksdhfgklsdagh")
						console.log(request_gate.response)			
                        localStorage.networking_credentialUsername = wonky_wtf.response_content.username
                        localStorage.networking_credentialPassword = wonky_wtf.response_content.password
                        localStorage.networking_credentialInviteCode = invite_code
                        localStorage.networking_allowStandbyAuth = "true"
						
						document.getElementById("authbar-welcome-login").addEventListener("click", function() {
//        					localStorage.networking_credentialUsername = request_gate.response.response_content.username
//        					localStorage.networking_credentialPassword = request_gate.response.response_content.password
//        					localStorage.networking_credentialInviteCode = invite_code
//        					localStorage.networking_allowStandbyAuth = "true"
							
        					check_if_logged_in()
							document.getElementById("notification").style.display = "block"
						}, 3000)
					}
				}
			}
		}
		request_gate.send(JSON.stringify(request_params))
	}
	
	console.log(localStorage.networking_allowStandbyAuth)
	
	function log_into_account(username, password) {
		request_path = "log_into_account"
		request_params = {"request_type": "log_into_account",
						  "username": username,
						  "password": password}
		request_gate.open("POST", request_host + request_path)
		request_gate.responseType = "json"
		request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
		request_gate.onreadystatechange = function() {
			if (request_gate.readyState == XMLHttpRequest.DONE) {
				console.log("Logging into an account: response received!")
				console.log(request_gate.response)
				if (request_gate.response["general_type"] == "error") {
					if (request_gate.response["response_type"] == "action_cancelled") {
						if (request_gate.response["response_content"] == "username_empty") {
							show_info(document.getElementById("authbar-contents-info"), "NO USERNAME WAS SPECIFIED.")
						} else if (request_gate.response["response_content"] == "password_empty") {
							show_info(document.getElementById("authbar-contents-info"), "NO PASSWORD WAS SPECIFIED.")
						}
					} else if (request_gate.response["response_type"] == "internal_error") {
						show_info(document.getElementById("authbar-contents-info"), "OOPS! A SERVER ERROR!")
					} else if (request_gate.response["response_type"] == "action_failed") {
						if (request_gate.response["response_content"] == "no_such_account") {
							show_info(document.getElementById("authbar-contents-info"), "INCORRECT USERNAME OR PASSWORD.")
						} else if (request_gate.response["response_content"] == "multiple_accounts") {
							show_info(document.getElementById("authbar-contents-info"), "WOMP! MULTIPLE ACCOUNTS WERE FOUND!")
						} else if (request_gate.response["response_content"] == "unknown") {
							show_info(document.getElementById("authbar-contents-info"), "OOPS! AN UNKNOWN ERROR HAPPENED!")
						}
					}
				} else if (request_gate.response["general_type"] == "success") {
					console.log("amogus")
					console.log(request_gate.response)
					if (request_gate.response["response_type"] == "account_found") {
						localStorage.networking_credentialUsername = username
						localStorage.networking_credentialPassword = password
//						localStorage.networking_credentialInviteCode = invite_code
						localStorage.networking_allowStandbyAuth = "true"
						
						document.getElementById("adminbar").style.display = "block"
					
						check_if_logged_in()
//						get_own_profile()
						get_posts("all", null)
					}
				}
			}
		}
		request_gate.send(JSON.stringify(request_params))
	}
	
	function async_get_account_data(username) {
		console.log("apparently this function does not exist????????????")
		return new Promise(function(resolve, reject) {
			console.log("FFS JAVASCRIPTTTTTTTTTTTTTTTTTT")
			var request_gate = new XMLHttpRequest()
			request_path = "get_account_info"
			request_params = {"request_type": "get_account_info",
							  "username": username}
			request_gate.open("POST", request_host + request_path)
			request_gate.responseType = "json"
			request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
			request_gate.onreadystatechange = function() {
				console.log("Getting account info: response received!")
				if (request_gate.readyState == XMLHttpRequest.DONE) {
					console.log("Getting account info: response received!")
					console.log(request_gate.response)
					if (request_gate.response["general_type"] == "error") {
						if (request_gate.response["response_type"] == "internal_error") {
							show_info(document.getElementById("authbar-contents-info"), "OOPS! A SERVER ERROR!")
						} else if (request_gate.response["response_type"] == "action_failed") {
							if (request_gate.response["response_content"] == "no_such_account") {
								show_info(document.getElementById("authbar-contents-info"), "NO SUCH ACCOUNTS WERE FOUND.")
							} else if (request_gate.response["response_content"] == "multiple_accounts") {
								show_info(document.getElementById("authbar-contents-info"), "WOMP! MULTIPLE ACCOUNTS WERE FOUND!")
							} else if (request_gate.response["response_content"] == "unknown") {
								show_info(document.getElementById("authbar-contents-info"), "OOPS! AN UNKNOWN ERROR HAPPENED!")
							}
						}
						reject(null)
					} else if (request_gate.response["general_type"] == "success") {
						if (request_gate.response["response_type"] == "account_found") {
							resolve(request_gate.response["response_content"])
						}
					}
				}
			}
			request_gate.send(JSON.stringify(request_params))
		})
	}
	
	function get_account_data(username) {
		request_path = "get_account_info"
		request_params = {"request_type": "get_account_info",
						  "username": username}
		request_gate.open("POST", request_host + request_path)
		request_gate.responseType = "json"
		request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
		request_gate.onreadystatechange = function() {
			if (request_gate.readyState == XMLHttpRequest.DONE) {
				console.log("Getting account info: response received!")
				console.log(request_gate.response)
				if (request_gate.response["general_type"] == "error") {
					if (request_gate.response["response_type"] == "internal_error") {
						show_info(document.getElementById("authbar-contents-info"), "OOPS! A SERVER ERROR!")
					} else if (request_gate.response["response_type"] == "action_failed") {
						if (request_gate.response["response_content"] == "no_such_account") {
							show_info(document.getElementById("authbar-contents-info"), "NO SUCH ACCOUNTS WERE FOUND.")
						} else if (request_gate.response["response_content"] == "multiple_accounts") {
							show_info(document.getElementById("authbar-contents-info"), "WOMP! MULTIPLE ACCOUNTS WERE FOUND!")
						} else if (request_gate.response["response_content"] == "unknown") {
							show_info(document.getElementById("authbar-contents-info"), "OOPS! AN UNKNOWN ERROR HAPPENED!")
						}
					}
					return null
				} else if (request_gate.response["general_type"] == "success") {
					if (request_gate.response["response_type"] == "account_found") {
						return request_gate.response["response_content"]
					}
				}
			}
		}
		request_gate.send(JSON.stringify(request_params))
	}
		
	async function get_own_profile() {
//		var own_profile_data = await get_account_data(localStorage.networking_credentialUsername)
//		console.log("Updating the userbar: getting the user data!")
//		console.log(own_profile_data)
//		
//		document.getElementById("userbar-profile-image").src = "own"
		async_get_account_data(localStorage.networking_credentialUsername).then(function(profile_content) {
			console.log("got the profile data!")
			console.log(profile_content)
			
			document.getElementById("userbar-profile-image").src = profile_content.pfpurl
			document.getElementById("userbar-profile-image").setAttribute('onerror', "this.onerror=null;this.src='https://loremflickr.com/320/320';") // if I replace the pfp placeholder gotta replace this URL too!
			document.getElementById("userbar-profile-username").innerHTML = localStorage.networking_credentialUsername
			document.getElementById("userbar-profile-status").innerHTML = profile_content.status
			
			document.getElementById("editbar-contents-username").value = localStorage.networking_credentialUsername
			document.getElementById("editbar-contents-password").value = localStorage.networking_credentialPassword
			document.getElementById("editbar-contents-profileiconurl").value = profile_content.pfpurl
			
			document.getElementById("userbar-background-image").src = localStorage.decoration_backgroundImageURL
			document.getElementById("userbar-background-image").setAttribute('onerror', "this.onerror=null;this.src='https://picsum.photos/800/600/?blur';") // same thing with replacing here
		})
	}
	
	function log_out_of_account() {
		if (localStorage.networking_allowStandbyAuth == "true") {
			console.log("Logging out: logging out of account...")
			localStorage.networking_allowStandbyAuth = "false"
			check_if_logged_in()
			get_posts("all", null)
		} else {
			console.log("Logging out: already logged out!")
		}
	}
	
	function update_account(oldusername, oldpassword, newusername, newpassword, newpfpurl) {
		request_path = "update_account_credentials"
		request_params = {"request_type": "update_account_credentials",
						  "username": oldusername,
						  "password": oldpassword,
						  "newusername": newusername,
						  "newpassword": newpassword,
						  "newpfpurl": newpfpurl}
		request_gate.open("POST", request_host + request_path)
		request_gate.responseType = "json"
		request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
		request_gate.onreadystatechange = function() {
			if (request_gate.readyState == XMLHttpRequest.DONE) {
				console.log("updating the account data & credentials: received response!")
				console.log(request_gate.response)
				if (request_gate.response["general_type"] == "error") {
					if (request_gate.response["response_type"] == "action_cancelled") {
						if (request_gate.response["response_content"] == "username_empty") {
							show_info(document.getElementById("editbar-contents-info"), "NO USERNAME WAS SPECIFIED.")
						} else if (request_gate.response["response_content"] == "password_empty") {
							show_info(document.getElementById("editbar-contents-info"), "NO PASSWORD WAS SPECIFIED.")
						}
					} else if (request_gate.response["response_type"] == "internal_error") {
						show_info(document.getElementById("editbar-contents-info"), "OOPS! A SERVER ERROR!")
					} else if (request_gate.response["response_type"] == "action_failed") {
						if (request_gate.response["response_content"] == "no_such_account") {
							show_info(document.getElementById("editbar-contents-info"), "INCORRECT USERNAME OR PASSWORD.")
						} else if (request_gate.response["response_content"] == "multiple_accounts") {
							show_info(document.getElementById("editbar-contents-info"), "WOMP! MULTIPLE ACCOUNTS WERE FOUND!")
						} else if (request_gate.response["response_content"] == "username_exists") {
							show_info(document.getElementById("editbar-contents-info"), "THIS USERNAME IS ALREADY USED!")
						} else if (request_gate.response["response_content"] == "unknown") {
							show_info(document.getElementById("editbar-contents-info"), "OOPS! AN UNKNOWN ERROR HAPPENED!")
						}
					}
				} else if (request_gate.response["general_type"] == "success") {
					if (request_gate.response["response_type"] == "account_updated") {
						show_info(document.getElementById("editbar-contents-info"), "CREDENTIALS UPDATED! RELOGGING...")
						setTimeout(function() {
							log_out_of_account()
						}, 1000)
						setTimeout(function() {
							log_into_account(newusername, newpassword)
						}, 1500)
						localStorage.decoration_backgroundImageURL = document.getElementById("editbar-contents-backgroundimageurl").value
					}
				}
			}
		}
		request_gate.send(JSON.stringify(request_params))			
	}
	
	function update_status(username, password, newstatus) {
		request_path = "update_account_status"
		request_params = {"request_type": "update_account_status",
						  "username": username,
						  "password": password,
						  "newstatus": newstatus}
		request_gate.open("POST", request_host + request_path)
		request_gate.responseType = "json"
		request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
		request_gate.onreadystatechange = function() {
			if (request_gate.readyState == XMLHttpRequest.DONE) {
				console.log("Updating account status: response received!")
				console.log(request_gate.response)
				if (request_gate.response["general_type"] == "error") {
					if (request_gate.response["response_type"] == "action_cancelled") {
						if (request_gate.response["response_content"] == "username_empty") {
							show_info(document.getElementById("userbar-profile-statusupdateinfo"), "NO USERNAME WAS SPECIFIED.")
						} else if (request_gate.response["response_content"] == "password_empty") {
							show_info(document.getElementById("userbar-profile-statusupdateinfo"), "NO PASSWORD WAS SPECIFIED.")
						}
					} else if (request_gate.response["response_type"] == "internal_error") {
						show_info(document.getElementById("userbar-profile-statusupdateinfo"), "OOPS! A SERVER ERROR!")
					} else if (request_gate.response["response_type"] == "action_failed") {
						if (request_gate.response["response_content"] == "no_such_account") {
							show_info(document.getElementById("userbar-profile-statusupdateinfo"), "INCORRECT USERNAME OR PASSWORD.")
						} else if (request_gate.response["response_content"] == "multiple_accounts") {
							show_info(document.getElementById("userbar-profile-statusupdateinfo"), "WOMP! MULTIPLE ACCOUNTS WERE FOUND!")
						} else if (request_gate.response["response_content"] == "unknown") {
							show_info(document.getElementById("userbar-profile-statusupdateinfo"), "OOPS! AN UNKNOWN ERROR HAPPENED!")
						}
					}
				} else if (request_gate.response["general_type"] == "success") {
					if (request_gate.response["response_type"] == "account_updated") {
						show_info(document.getElementById("userbar-profile-statusupdateinfo"), "UPDATED YOUR STATUS!")
						refresh()
					}
				}
			}
		}
		request_gate.send(JSON.stringify(request_params))
	}
	
	function upload_a_post(username, password, contents, tag, mention) {
		request_path = "upload_a_post"
		request_params = {"request_type": "upload_a_post",
						  "username": username,
						  "password": password,
						  "contents": contents,
						  "tag": tag,
						  "mention": mention,
						  "post_type": "textpost"}
		request_gate.open("POST", request_host + request_path)
		request_gate.responseType = "json"
		request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
		request_gate.onreadystatechange = function() {
			if (request_gate.readyState == XMLHttpRequest.DONE) {
				console.log("Submitting a post: received a response.")
				console.log(request_gate.response)
				if (request_gate.response["general_type"] == "error") {
					if (request_gate.response["response_type"] == "action_cancelled") {
						if (request_gate.response["response_content"] == "username_empty") {
							show_info(document.getElementById("postbar-submitinfo"), "No username was specified.")
						} else if (request_gate.response["response_content"] == "password_empty") {
							show_info(document.getElementById("postbar-submitinfo"), "No username was specified.")
						}
					} else if (request_gate.response["response_type"] == "internal_error") {
						show_info(document.getElementById("postbar-submitinfo"), "Womp! A server error occured.")
					} else if (request_gate.response["response_type"] == "action_failed") {
						if (request_gate.response["response_content"] == "no_such_account") {
							show_info(document.getElementById("postbar-submitinfo"), "Your stored credentials are invalid.")
						} else if (request_gate.response["response_content"] == "multiple_accounts") {
							show_info(document.getElementById("postbar-submitinfo"), "Multiple accounts with your username were found!")
						} else if (request_gate.response["response_content"] == "post_too_short") {
							show_info(document.getElementById("postbar-submitinfo"), `Your post is <i>still</i> ${String(15 - document.getElementById("postbar-postinput").value.length)} characters too short.`)
						} else if (request_gate.response["response_content"] == "post_type_mismatch") {
							show_info(document.getElementById("postbar-submitinfo"), "Incorrect post type.")
						} else if (request_gate.response["response_content"] == "unknown") {
							show_info(document.getElementById("postbar-submitinfo"), "Womp! An unknown error happened.")
						}
					}
				} else if (request_gate.response["general_type"] == "success") {
					if (request_gate.response["response_type"] == "post_uploaded") {
						show_info(document.getElementById("postbar-submitinfo"), "Post has succesfully been uploaded!")
						document.getElementById("postbar-postinput").value = ""
						document.getElementById("postbar-taginput").value = ""
						document.getElementById("postbar-mentioninput").value = ""
						refresh()
					}
				}
			}
		}
		request_gate.send(JSON.stringify(request_params))
	}
	
	function get_posts(type, args) {
		// all - textposts and activation messages.
		// mentions - posts which mention the user.
		// updates - status updates.
		// news - what's new/update log.
		// search:tagged - posts tagged something.
		// search:user - look up a user and their posts.
		// help - tips and docs.
		if (["all", "mentions", "updates", "news", "tagged", "user", "mentioned", "help"].indexOf(type) > -1) {
			if (type == "all") {
                request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "all"}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
						clear_feed()
						for (var post of request_gate.response) {
							if (post.type == "textpost") {
                                if (post.creatorid != null) {
                                    add_post_to_feed(post.creatorusername, post.creatorpfpurl,
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                } else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
                                    add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                }
							} else if (post.type == "activation") {
								add_post_to_feed(null, null,
                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, null, null, null, "activation")
							}
//							else if (post.type == "status") {
//								add_post_to_feed(post.creatorusername, post.creatorpfpurl,
//                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "status")
//							}
						}
						var feed_beginning = document.createElement('div')
						feed_beginning.setAttribute('id', 'post-starter')
						feed_beginning.innerHTML = "This is the start of the feed."
						document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
            } else if (type == "mentions") {
				request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "mentions",
								  "mentions_target": args}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
						clear_feed()
						for (var post of request_gate.response) {
							if (post.creatorid != null) {
								add_post_to_feed(post.creatorusername, post.creatorpfpurl,
								post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention)
							} else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
								add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
								post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention)
							}
						}
						var feed_beginning = document.createElement('div')
						feed_beginning.setAttribute('id', 'post-starter')
						feed_beginning.innerHTML = "This is the start of the feed."
						document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
            } else if (type == "updates") {
                request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "updates"}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
                        clear_feed()
                        for (var post of request_gate.response) {
                            if (post.creatorid != null) {
                                add_post_to_feed(post.creatorusername, post.creatorpfpurl,
                                post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "status")
                            } else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
                                add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
                                post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "status")
                            }
                        }
                        var feed_beginning = document.createElement('div')
                        feed_beginning.setAttribute('id', 'post-starter')
                        feed_beginning.innerHTML = "This is the start of the feed."
                        document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
            } else if (type == "news") {
                request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "news"}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
                        clear_feed()
                        for (var post of request_gate.response) {
                            if (post.creatorid != null) {
                                add_post_to_feed(post.creatorusername, post.creatorpfpurl,
                                post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "news")
                            } else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
                                add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
                                post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "news")
                            }
                        }
                        var feed_beginning = document.createElement('div')
                        feed_beginning.setAttribute('id', 'post-starter')
                        feed_beginning.innerHTML = "This is the start of the feed."
                        document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
			} else if (type == "tagged") {
                request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "tagged",
								  "tagged_with": args}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
						clear_feed()
						for (var post of request_gate.response) {
							if (post.type == "textpost") {
                                if (post.creatorid != null) {
                                    add_post_to_feed(post.creatorusername, post.creatorpfpurl,
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                } else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
                                    add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                }
							} else if (post.type == "activation") {
								add_post_to_feed(null, null,
                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, null, null, null, "activation")
							}
//							else if (post.type == "status") {
//								add_post_to_feed(post.creatorusername, post.creatorpfpurl,
//                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "status")
//							}
						}
						var feed_beginning = document.createElement('div')
						feed_beginning.setAttribute('id', 'post-starter')
						feed_beginning.innerHTML = "This is the start of the feed."
						document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
            } else if (type == "mentioned") {
                request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "mentioned",
								  "mentions_who": args}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
						clear_feed()
						for (var post of request_gate.response) {
							if (post.type == "textpost") {
                                if (post.creatorid != null) {
                                    add_post_to_feed(post.creatorusername, post.creatorpfpurl,
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                } else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
                                    add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                }
							} else if (post.type == "activation") {
								add_post_to_feed(null, null,
                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, null, null, null, "activation")
							}
//							else if (post.type == "status") {
//								add_post_to_feed(post.creatorusername, post.creatorpfpurl,
//                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "status")
//							}
						}
						var feed_beginning = document.createElement('div')
						feed_beginning.setAttribute('id', 'post-starter')
						feed_beginning.innerHTML = "This is the start of the feed."
						document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
			} else if (type == "user") {
                request_path = "get_posts"
                request_params = {"request_type": "get_posts",
                                  "post_type": "user",
								  "username": args}
                request_gate.open("POST", request_host + request_path)
                request_gate.responseType = "json"
                request_gate.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                request_gate.onreadystatechange = function() {
                    if (request_gate.readyState == XMLHttpRequest.DONE) {
                        console.log("getting all posts: response received!")
                        console.log(request_gate.response)
						clear_feed()
						for (var post of request_gate.response) {
							if (post.type == "textpost") {
                                if (post.creatorid != null) {
                                    add_post_to_feed(post.creatorusername, post.creatorpfpurl,
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                } else { // author, pfp, hour, minute, day, month, year, contents, tag, mention
                                    add_post_to_feed("<i style='color: #EEEEEE'>post has no account attached</i>", "https://placehold.co/80/png?text=%28%E2%97%8F_%E2%97%8F%29",
                                    post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, post.tag, post.mention, "textpost")
                                }
							} else if (post.type == "activation") {
								add_post_to_feed(null, null,
                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, null, null, null, "activation")
							}
//							else if (post.type == "status") {
//								add_post_to_feed(post.creatorusername, post.creatorpfpurl,
//                              	post.creationhour, post.creationminute, post.creationday, post.creationmonth, post.creationyear, post.contents, null, null, "status")
//							}
						}
						var feed_beginning = document.createElement('div')
						feed_beginning.setAttribute('id', 'post-starter')
						feed_beginning.innerHTML = "This is the start of the feed."
						document.getElementById("postfeedcontents").appendChild(feed_beginning)
                    }
                }
                request_gate.send(JSON.stringify(request_params))
            } else {
                show_info(document.getElementById("feed-retrievalinfo"), "Choose a correct post type.")
            }
		}
	}
	
	function refresh() {
		if (highlitedfilteroption == "all") {
			get_posts("all", null)
		} else if (highlitedfilteroption == "mentions") {
			get_posts("mentions", localStorage.networking_credentialUsername)
		} else if (highlitedfilteroption == "updates") {
			get_posts("updates", null)
		} else if (highlitedfilteroption == "news") {
			get_posts("news", null)
		} else if (highlitedfilteroption == "help") {
			get_posts("help", null)
		} else if (highlitedfilteroption == "search") {
			if (highlitedsearchoption == "look-for-a-tag") {
				get_posts("tagged", document.getElementById("searchbar-input").value)
			} else if (highlitedsearchoption == "look-for-a-user") {
				get_posts("user", document.getElementById("searchbar-input").value)
			} else {
				get_posts("mentioned", document.getElementById("searchbar-input").value)
			}
		}
	}
	
	document.getElementById("authbar-contents-useinvitecode").addEventListener("click", function() {
		if (document.getElementById("authbar-contents-invitecode").value.length == 0) {
			show_info(document.getElementById("authbar-contents-info"), "INVITE CODE FIELD IS EMPTY")
		} else if (document.getElementById("authbar-contents-invitecode").value.length < 4) {
			show_info(document.getElementById("authbar-contents-info"), "INVITE CODE TOO SHORT")
		} else {
			show_info(document.getElementById("authbar-contents-info"), "CHECKING FOR ACCOUNT...")
			activate_account(document.getElementById("authbar-contents-invitecode").value)
		}
	})
	
	document.getElementById("authbar-contents-useaccount").addEventListener("click", function() {
		if (document.getElementById("authbar-contents-username").value.length == 0) {
			show_info(document.getElementById("authbar-contents-info"), "ENTER YOUR USERNAME.")
		} else {
			if (document.getElementById("authbar-contents-password").value.length == 0) {
				show_info(document.getElementById("authbar-contents-info"), "ENTER A PASSWORD.")
			} else {
				show_info(document.getElementById("authbar-contents-info"), "CHECKING FOR ACCOUNT...")
				log_into_account(document.getElementById("authbar-contents-username").value, document.getElementById("authbar-contents-password").value)
			}
		}
	})
	
	document.getElementById("editbar-contents-submitchanges").addEventListener("click", function() {
		if (document.getElementById("editbar-contents-username").value.length == 0) {
			show_info(document.getElementById("editbar-contents-info"), "USERNAME FIELD IS EMPTY.")
		} else {
			if (document.getElementById("editbar-contents-password").value.length == 0) {
				show_info(document.getElementById("editbar-contents-info"), "PASSWORD FIELD IS EMPTY.")
			} else {
				update_account(localStorage.networking_credentialUsername, localStorage.networking_credentialPassword, document.getElementById("editbar-contents-username").value, document.getElementById("editbar-contents-password").value, document.getElementById("editbar-contents-profileiconurl").value)
			}
		}
	})
	
	document.getElementById("editbar-contents-logout").addEventListener("click", log_out_of_account)
	
	document.getElementById("userbar-profile-updatestatus").addEventListener("click", function() {
		update_status(localStorage.networking_credentialUsername, localStorage.networking_credentialPassword, document.getElementById("userbar-profile-status").value)
	})
	
	document.getElementById("postbar-submitbutton").addEventListener("click", function() {
		if (document.getElementById("postbar-postinput").value.length < 16) {
			show_info(document.getElementById("postbar-submitinfo"), `Your post is ${String(15 - document.getElementById("postbar-postinput").value.length)} characters too short.`)
		} else {
			upload_a_post(localStorage.networking_credentialUsername, localStorage.networking_credentialPassword, document.getElementById("postbar-postinput").value, document.getElementById("postbar-taginput").value, document.getElementById("postbar-mentioninput").value)
		}
	})
	
	document.getElementById("notification-close").addEventListener("click", function() {
		document.getElementById("notification").style.display = "none"
	})
	
	document.getElementById("filterbar-filter-all").addEventListener("click", function() {
		get_posts("all", null)
	})
	document.getElementById("filterbar-filter-mentions").addEventListener("click", function() {
		get_posts("mentions", localStorage.networking_credentialUsername)
	})
	document.getElementById("filterbar-filter-updates").addEventListener("click", function() {
		get_posts("updates", null)
	})
	document.getElementById("filterbar-filter-news").addEventListener("click", function() {
		get_posts("news", null)
	})
	document.getElementById("filterbar-filter-help").addEventListener("click", function() {
		get_posts("help", null)
	})
	document.getElementById("searchbar-submitbutton").addEventListener("click", function() {
		if (highlitedsearchoption == "look-for-a-tag") {
			get_posts("tagged", document.getElementById("searchbar-input").value)
		} else if (highlitedsearchoption == "look-for-a-user") {
			get_posts("user", document.getElementById("searchbar-input").value)
		} else {
			get_posts("mentioned", document.getElementById("searchbar-input").value)
		}
	})
	document.getElementById("feed-refresh").addEventListener("click", refresh)
	
	document.getElementById("authbar-contents-username").addEventListener('keydown', function onEvent(event) {
    	if (event.keyCode == 9) {
			document.getElementById("authbar-contents-invitecode").focus()
		}
	})
	
	document.getElementById("authbar-contents-password").addEventListener('keydown', function onEvent(event) {
    	if (event.key === "Enter") {
        	if (document.getElementById("authbar-contents-username").value.length == 0) {
				show_info(document.getElementById("authbar-contents-info"), "ENTER YOUR USERNAME.")
			} else {
				if (document.getElementById("authbar-contents-password").value.length == 0) {
					show_info(document.getElementById("authbar-contents-info"), "ENTER A PASSWORD.")
				} else {
					show_info(document.getElementById("authbar-contents-info"), "CHECKING FOR ACCOUNT...")
					log_into_account(document.getElementById("authbar-contents-username").value, document.getElementById("authbar-contents-password").value)
				}
			}
    	}
	});
	
	//check_if_logged_in()
	get_posts("all", null)
	var translated = true
	translate(translated)
	document.getElementById("headerbar-languagebutton").addEventListener("click", function() {
		translated = !translated
		translate(translated)
	})
	highlight_search_option("searchbar-option-user")
	
//	add_post_to_feed("dashka kakaska", "https://www.tutorialspoint.com/javascript/images/javascript-mini-logo.jpg", "21", "32", "10", "03", "2023", "brbrbrhjkfgkdfjlgshdfklghjkldfkhgl")
//	add_post_to_feed("amogus", "amogus", "amogus", "amogus", "amogus", "amogus", "amogus", "amogus")
//	add_post_to_feed("Valeria Michailovna", "https://static.chipdip.ru/lib/110/DOC011110746.jpg", "22", "32", "10", "03", "2023", "and what is this?")
//	add_post_to_feed("AMOGUSUSSY AMOGUS BRUH 1337", "https://i.pinimg.com/originals/32/4d/fd/324dfd2d44ad3815562cb5136c78c9b9.jpg", "22", "34", "10", "03", "2023", "AMOGUS FARD REAL@?????????????????????????")
//	add_post_to_feed("valerie's posts", "https://monitoringminecraft.ru/player/.default/skin.png", "14", "24", "15", "03", "2023", "opkay cool we got posts yay", "thoughts", null)
//	add_post_to_feed("valerie's posts", "https://monitoringminecraft.ru/player/.default/skin.png", "14", "27", "15", "03", "2023", "i really wish that supermarkets had better delivery", "thoughts", null)
}